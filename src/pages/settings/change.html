<template>
    <require from="./filter-available-options"></require>
  <a click.trigger="back()">Back</a>
  <fieldset repeat.for="column of settings.columns">
    <input name="title" value.bind="column.title" />
    <select value.bind="column.basedOn">
      <option repeat.for="option of settings.columnBaseTypes" value.bind="option">
        ${option}
      </option>
    </select>
    <div repeat.for="value of column.value">
      <input value.bind="value" if.bind="column.basedOn === 'label'" />
      <select value.bind="column.value[$index]"
          if.bind="column.basedOn === 'state'"
          change.trigger="valueHasChanged(column.value[$index])">
        <option 
            repeat.for="option of settings.storyStates | filterAvailableOptions:settings.columns:column.value[$index] & signal:'available-options-changed'"
            value.bind="option">
          ${option}
        </option>
      </select>
      <input type="submit" value="Remove" 
          click.delegate="removeValueFromColumn(value, column)" />
    </div>
    <input type="submit"value="Add"
        if.bind="column.basedOn === 'label' || availableStoryStates"
        click.delegate="addValueForColumn(column)" />
  </fieldset>
</template>
